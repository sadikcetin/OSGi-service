package org.sifirbir.osgi.manager;

import org.eclipse.osgi.framework.console.CommandProvider;
import org.osgi.framework.BundleActivator;
import org.osgi.framework.BundleContext;
import org.osgi.util.tracker.ServiceTracker;
import org.sifirbir.osgi.language.api.ILanguage;
import org.sifirbir.osgi.languagecommand.api.ILanguageCommand;
import org.sifirbir.osgi.manager.api.IManager;
import org.sifirbir.osgi.manager.impl.ManagerImpl;

public class Activator implements BundleActivator {
	
	private IManager clientSadik;
	private ServiceTracker tracker;
	private ServiceTracker commandTracker; 
	
	

	public void start(BundleContext context) throws Exception {
		
		System.out.println("*** HELLO MANAGER ***");
	
		tracker = new ServiceTracker(context,ILanguage.class.getName(),null);
		commandTracker = new ServiceTracker(context,CommandProvider.class.getName(),null);
		commandTracker.open();
		tracker.open();
		System.out.println("Command Service Size = "+ commandTracker.size());
		System.out.println("Size = "+tracker.size());
		
		
		Object[]  langServices = new Object[tracker.size()];
		langServices= tracker.getServices();
		
		Object[] commandServices = new Object[commandTracker.size()];
		commandServices = commandTracker.getServices();
		
		System.out.println(langServices[0]+" + "+commandServices[0]);
		try {
			new ManagerImpl((ILanguage)langServices[2],(ILanguageCommand)commandServices[0]);
			
		} catch (Exception e) {
			System.out.println(e.getMessage());
		}
		 
		
	}
	
	public void stop(BundleContext context) throws Exception {
		System.out.println("GoodBye MANAGER  ");
		tracker.close();
	}

}
